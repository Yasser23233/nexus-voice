# Nexus Voice

Nexus Voice هو تطبيق دردشة صوتية جماعية بسيط مبني على تقنيات **WebRTC** و**Socket.IO**. يوفر التطبيق واجهة مظلمة مع تفاصيل ذهبية تتميز بتأثيرات glitch وضوضاء لمحبي المظهر "الهاكر". يمكن لتسعة مستخدمين ثابتين اختيار أسماء محددة والاتصال بغرفة مشتركة عبر رابط واحد بدون الحاجة إلى كلمات مرور. يستخدم التطبيق خادم إشارة مبني على Node.js وExpress لتنسيق الاتصالات بين الأقران، ويمكن تهيئته للعمل مع خوادم STUN/TURN لتجاوز جدران الحماية وNAT.

## الميزات

- شاشة لوبي بسيطة لاختيار أحد الأسماء التسعة المتاحة مسبقًا.
- تصميم داكن وأنيق مع خطوط **Roboto Mono** وإضاءة ذهبية.
- اتصال صوتي آنى بين جميع الأعضاء عبر WebRTC، مع استخدام Socket.IO لتمرير رسائل الإشارة.
- مؤشر بصري يوضح من يتحدث حاليًا باستخدام تحليل الصوت في المتصفح.
- إمكانية كتم الصوت ونسخ رابط الغرفة بسهولة.
- دعم إعادة الاتصال التلقائي واكتشاف تغيّر الأجهزة الصوتية.
- جاهز للعمل مع ngrok لتوفير رابط خارجي دون نشر التطبيق على خادم عام.
- اختبار ضغط باستخدام Puppeteer للتحقق من الأداء تحت الأحمال العالية.

## المتطلبات المسبقة

- **Node.js** إصدار 20 أو أعلى.
- **npm** لتنصيب التبعيات وتشغيل السكربتات.
- (اختياري) أداة [ngrok](https://ngrok.com/) لإنشاء نفق عام للجهاز المحلي.
- (اختياري) خادم TURN (مثل Coturn) لتمرير الاتصالات في حال تعذر الاتصال المباشر بين الأقران.

## التثبيت

بعد فك ضغط الحزمة أو استنساخ المستودع، قم بتنصيب التبعيات عبر الأمر:

```bash
npm install
```

ثم أنشئ ملف `.env` بناءً على `.env.example` وعدّل القيم حسب احتياجك:

```bash
cp .env.example .env
# افتح .env وحدد PORT وSTUN_URL وTURN_URL وTURN_USER وTURN_PASS وRELAY_ONLY عند الحاجة
```

## تشغيل الخادم

لتشغيل الخادم محليًا:

```bash
npm start
```

سيستمع التطبيق على المنفذ المحدد في ملف `.env` (الافتراضي `3000`). بعد التشغيل، افتح المتصفح على `http://localhost:3000` للدخول إلى اللوبي.

أثناء التطوير يمكنك استخدام nodemon لمراقبة التغييرات تلقائيًا:

```bash
npm run dev
```

### إنشاء نفق عبر ngrok

إذا أردت مشاركة الغرفة مع مستخدمين خارج شبكتك المحلية دون نشر التطبيق على خادم عام، يمكنك استخدام ngrok. بعد تشغيل الخادم، نفّذ الأمر التالي في نافذة طرفية أخرى:

```bash
npm run tunnel
```

ستعرض الأداة عنوان URL خارجي (HTTPS) يمكنك مشاركته مع الآخرين؛ عند فتحه سيرون نفس اللوبي والغرفة.

### اختبار الضغط

يستخدم سكربت `test/loadTest.js` مكتبة Puppeteer لإطلاق جلسة متصفح رأسية لكل اسم مستخدم والانضمام إلى الغرفة بشكل متزامن. تأكد من تشغيل الخادم محليًا، ثم نفّذ:

```bash
npm run load-test
```

سيتيح لك ذلك قياس أداء الإشارة وموارد الجهاز تحت الضغط.

## إعداد خادم TURN

عندما يكون المشاركون خلف جدران حماية أو أجهزة توجيه قد لا ينجح الاتصال المباشر بينهم. لهذا السبب يدعم Nexus Voice خادم TURN. يتضمن المشروع مثالًا لـ **docker-compose** وملف إعداد لـ [Coturn](https://github.com/coturn/coturn) لتسهيل العملية:

```bash
docker-compose up -d
```

بعد تشغيل الخادم، حدّث قيم TURN في ملف `.env`:

```
TURN_URL=turn:your.domain.com:3478
TURN_USER=turnuser
TURN_PASS=secret
RELAY_ONLY=true
```

تعيين `RELAY_ONLY=true` سيجبر WebRTC على استخدام TURN دائمًا حتى إن كان الاتصال المباشر ممكنًا.

## هيكل المشروع

- `server/` – يحتوي على خادم Express، التهيئة، وملفات Socket.IO.
- `client/public/` – ملفات HTML وCSS وJavaScript التي تُقدّم للمتصفح.
- `assets/` – الشعارات والملفات الثابتة الأخرى.
- `scripts/` – سكربتات مساعدة لتشغيل التطبيق والتحقق من البيئة.
- `test/` – سكربتات اختبار الضغط.
- `docker-compose.yml` – مثال لتشغيل التطبيق مع coturn.
- `turnserver.conf` – مثال لإعداد خادم Coturn.

## المساهمة

يسعدنا تلقي المساهمات! يرجى قراءة ملف `CONTRIBUTING.md` للاطلاع على إرشادات المساهمة وأسلوب كتابة الكود.

## الرخصة

هذا المشروع مرخّص بموجب رخصة MIT. راجع ملف `LICENSE` للمزيد من التفاصيل.